<!DOCTYPE HTML>
<html lang="ja" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>例題でみる sbt - The Book of sbt</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="src/reference/custom-202410.css">
        <link rel="stylesheet" href="src/reference/mdbook-admonish.css">
        <link rel="stylesheet" href="theme/language-picker.css">


        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            
            // var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
            var default_theme = "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">The Book of sbt</h1>

                    <div class="right-buttons">
                        <button id="language-toggle" class="icon-button" type="button"
                                title="Change language" aria-label="Change language"
                                aria-haspopup="true" aria-expanded="false"
                                aria-controls="language-list">
                            <i class="fa fa-globe"></i>
                        </button>
                        <ul id="language-list" class="theme-popup" aria-label="Languages" role="menu">
                          <li role="none"><button role="menuitem" class="theme">
                              <a id="en">English</a>
                          </button></li>
                          <li role="none"><button role="menuitem" class="theme">
                              <a id="zh-cn">Chinese Simplified (中文)</a>
                          </button></li>
                          <li role="none"><button role="menuitem" class="theme">
                              <a id="ja">Japanese (日本語)</a>
                          </button></li>
                        </ul>
                        <script>
                          let langToggle = document.getElementById("language-toggle");
                          let langList = document.getElementById("language-list");
                          langToggle.addEventListener("click", (event) => {
                              langList.style.display = langList.style.display == "block" ? "none" : "block";
                          });
                          let selectedLang = document.getElementById("ja");
                          if (selectedLang) {
                              selectedLang.parentNode.classList.add("theme-selected");
                          }

                          // The path to the root, taking the current
                          // language into account.
                          let full_path_to_root = "../";
                          // The page path (mdbook only gives us
                          // access to the path to the Markdown file).
                          let path = "sbt-by-example.md".replace(/\.md$/, ".html");
                          for (let lang of langList.querySelectorAll("a")) {
                            lang.href = `${full_path_to_root}${lang.id}/${path}`;
                          }

                          // When the user clicks a list item, the page jump is performed, just like clicking the internal <a> tag.
                          langList.querySelectorAll("li").forEach(function(li) {
                            li.addEventListener("click", function(event) {
                              event.preventDefault();
        
                              let link = this.querySelector("a");
                              if (link && window.location.href !== link.href) {
                                window.location.href = link.href;
                              }
                            });
                          });
                        </script>

                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="例題でみる-sbt"><a class="header" href="#例題でみる-sbt">例題でみる sbt</a></h1>
<p>このページは、 <a href="Setup.html">sbt runner をインストール</a>したことを前提とする。</p>
<p>sbt の内部がどうなっているかや理由みたいなことを解説する代わりに、例題を次々と見ていこう。</p>
<h3 id="最小-sbt-ビルドを作る"><a class="header" href="#最小-sbt-ビルドを作る">最小 sbt ビルドを作る</a></h3>
<pre><code class="language-bash">mkdir foo-build
cd foo-build
touch build.sbt
mkdir project
echo "sbt.version=2.0.0-RC3" &gt; project/build.properties
</code></pre>
<h3 id="sbt-シェルを起ち上げる"><a class="header" href="#sbt-シェルを起ち上げる">sbt シェルを起ち上げる</a></h3>
<pre><code class="language-bash">$ sbt
[info] welcome to sbt 2.0.0-RC3 (Azul Systems, Inc. Java)
....
[info] started sbt server
sbt:foo-build&gt;
</code></pre>
<h3 id="sbt-シェルを終了させる"><a class="header" href="#sbt-シェルを終了させる">sbt シェルを終了させる</a></h3>
<p>sbt シェルを終了させるには、<code>exit</code> と入力するか、Ctrl+D (Unix) か Ctrl+Z (Windows) を押す。</p>
<pre><code>sbt:foo-build&gt; exit
</code></pre>
<h3 id="プロジェクトをコンパイルする"><a class="header" href="#プロジェクトをコンパイルする">プロジェクトをコンパイルする</a></h3>
<p>表記の慣例として <code>sbt:...&gt;</code> や <code>&gt;</code> というプロンプトは、sbt シェルに入っていることを意味することにする。</p>
<pre><code class="language-bash">$ sbt
sbt:foo-build&gt; compile
[success] elapsed time: 0 s, cache 0%, 1 onsite task
</code></pre>
<h3 id="コード変更時に再コンパイルする"><a class="header" href="#コード変更時に再コンパイルする">コード変更時に再コンパイルする</a></h3>
<p><code>compile</code> コマンド (やその他のコマンド) を <code>~</code> で始めると、プロジェクト内のソース・ファイルが変更されるたびにそのコマンドが自動的に再実行される。</p>
<pre><code>sbt:foo-build&gt; ~compile
[success] elapsed time: 0 s, cache 100%, 1 disk cache hit
[info] 1. Monitoring source files for foo-build/compile...
[info]    Press &lt;enter&gt; to interrupt or '?' for more options.
</code></pre>
<h3 id="ソースファイルを書く"><a class="header" href="#ソースファイルを書く">ソース・ファイルを書く</a></h3>
<p>上記のコマンドは走らせたままにする。別のシェルかファイルマネージャーからプロジェクトのディレクトリへ行って、<code>src/main/scala/example</code> というディレクトリを作る。次に好きなエディタを使って <code>example</code> ディレクトリ内に以下のファイルを作成する:</p>
<pre><code class="language-scala">package example

@main def main(args: String*): Unit =
  println(s"Hello ${args.mkString}")
</code></pre>
<p>この新しいファイルは実行中のコマンドが自動的に検知したはずだ:</p>
<pre><code>[info] Build triggered by /tmp/foo-build/src/main/scala/example/Hello.scala. Running 'compile'.
[info] compiling 1 Scala source to /tmp/foo-build/target/out/jvm/scala-3.3.3/foo/backend ...
[success] elapsed time: 1 s, cache 0%, 1 onsite task
[info] 2. Monitoring source files for foo-build/compile...
[info]    Press &lt;enter&gt; to interrupt or '?' for more options.
</code></pre>
<p><code>~compile</code> を抜けるには <code>Enter</code> を押す。</p>
<h3 id="以前のコマンドを実行する"><a class="header" href="#以前のコマンドを実行する">以前のコマンドを実行する</a></h3>
<p>sbt シェル内で上矢印キーを 2回押して、上で実行した <code>compile</code> コマンドを探す。</p>
<pre><code>sbt:foo-build&gt; compile
</code></pre>
<h3 id="ヘルプを読む"><a class="header" href="#ヘルプを読む">ヘルプを読む</a></h3>
<p><code>help</code> コマンドを使って、基礎コマンドの一覧を表示する。</p>
<pre><code>sbt:foo-build&gt; help

  &lt;command&gt; (; &lt;command&gt;)*                       Runs the provided semicolon-separated commands.
  about                                          Displays basic information about sbt and the build.
  tasks                                          Lists the tasks defined for the current project.
  settings                                       Lists the settings defined for the current project.
  reload                                         (Re)loads the current project or changes to plugins project or returns from it.
  new                                            Creates a new sbt build.
  new                                            Creates a new sbt build.
  projects                                       Lists the names of available projects or temporarily adds/removes extra builds to the session.

....
</code></pre>
<p>特定のタスクの説明を表示させる:</p>
<pre><code>sbt:foo-build&gt; help run
Runs a main class, passing along arguments provided on the command line.
</code></pre>
<h3 id="アプリを実行する"><a class="header" href="#アプリを実行する">アプリを実行する</a></h3>
<pre><code>sbt:foo-build&gt; run
[info] running example.main
Hello
[success] elapsed time: 0 s, cache 50%, 1 disk cache hit, 1 onsite task
</code></pre>
<h3 id="sbt-シェルから-scalaversion-を設定する"><a class="header" href="#sbt-シェルから-scalaversion-を設定する">sbt シェルから scalaVersion を設定する</a></h3>
<pre><code>sbt:foo-build&gt; set scalaVersion := "3.7.2"
[info] Defining scalaVersion
[info] The new value will be used by Compile / bspBuildTarget, Compile / dependencyTreeCrossProjectId and 51 others.
[info]  Run `last` for details.
[info] Reapplying settings...
[info] set current project to foo (in build file:/tmp/foo-build/)
</code></pre>
<p><code>scalaVersion</code> セッティングを確認する:</p>
<pre><code>sbt:foo-build&gt; scalaVersion
[info] 3.7.2
</code></pre>
<h3 id="セッションを-buildsbt-へと保存する"><a class="header" href="#セッションを-buildsbt-へと保存する">セッションを build.sbt へと保存する</a></h3>
<p>アドホックに設定したセッティングは <code>session save</code> で保存できる。</p>
<pre><code>sbt:foo-build&gt; session save
[info] Reapplying settings...
[info] set current project to foo-build (in build file:/tmp/foo-build/)
[warn] build source files have changed
[warn] modified files:
[warn]   /tmp/foo-build/build.sbt
[warn] Apply these changes by running `reload`.
[warn] Automatically reload the build when source changes are detected by setting `Global / onChangedBuildSource := ReloadOnSourceChanges`.
[warn] Disable this warning by setting `Global / onChangedBuildSource := IgnoreSourceChanges`.
</code></pre>
<p><code>build.sbt</code> ファイルは以下のようになったはずだ:</p>
<pre><code class="language-scala">scalaVersion := "3.7.2"

</code></pre>
<h3 id="プロジェクトに名前を付ける"><a class="header" href="#プロジェクトに名前を付ける">プロジェクトに名前を付ける</a></h3>
<p>エディタを使って、<code>build.sbt</code> を以下のように変更する:</p>
<pre><code class="language-scala">scalaVersion := "3.3.3"
organization := "com.example"
name := "Hello"
</code></pre>
<h3 id="ビルドの再読み込み"><a class="header" href="#ビルドの再読み込み">ビルドの再読み込み</a></h3>
<p><code>reload</code> コマンドを使ってビルドを再読み込みする。このコマンドは <code>build.sbt</code> を読み直して、そこに書かれたセッティングを再適用する。</p>
<pre><code>sbt:foo-build&gt; reload
[info] welcome to sbt 2.x (Azul Systems, Inc. Java)
[info] loading project definition from /tmp/foo-build/project
[info] loading settings for project hello from build.sbt ...
[info] set current project to Hello (in build file:/tmp/foo-build/)
sbt:Hello&gt;
</code></pre>
<p>プロンプトが <code>sbt:Hello&gt;</code> に変わったことに注目してほしい。</p>
<h3 id="librarydependencies-に-toolkit-test-を追加する"><a class="header" href="#librarydependencies-に-toolkit-test-を追加する">libraryDependencies に toolkit-test を追加する</a></h3>
<p>エディタを使って、<code>build.sbt</code> を以下のように変更する:</p>
<pre><code class="language-scala">scalaVersion := "3.3.3"
organization := "com.example"
name := "Hello"
libraryDependencies += "org.scala-lang" %% "toolkit-test" % "0.1.7" % Test
</code></pre>
<p><code>reload</code> コマンドを使って、<code>build.sbt</code> の変更を反映させる。</p>
<pre><code>sbt:Hello&gt; reload
</code></pre>
<h3 id="差分テストを実行する"><a class="header" href="#差分テストを実行する">差分テストを実行する</a></h3>
<pre><code>sbt:Hello&gt; test
</code></pre>
<h3 id="差分テストを継続的に実行する"><a class="header" href="#差分テストを継続的に実行する">差分テストを継続的に実行する</a></h3>
<pre><code>sbt:Hello&gt; ~test
</code></pre>
<h3 id="テストを書く"><a class="header" href="#テストを書く">テストを書く</a></h3>
<p>上のコマンドを走らせたままで、エディタから <code>src/test/scala/example/HelloSuite.scala</code> という名前のファイルを作成する:</p>
<pre><code class="language-scala">package example

class HelloSuite extends munit.FunSuite:
  test("Hello should start with H") {
    assert("hello".startsWith("H"))
  }
end HelloSuite
</code></pre>
<p><code>~test</code> が検知したはずだ:</p>
<pre><code>example.HelloSuite:
==&gt; X example.HelloSuite.Hello should start with H  0.012s munit.FailException: /tmp/foo-build/src/test/scala/example/HelloSuite.scala:5 assertion failed
4:  test("Hello should start with H") {
5:    assert("hello".startsWith("H"))
6:  }
    at munit.FunSuite.assert(FunSuite.scala:11)
    at example.HelloSuite.$init$$$anonfun$1(HelloSuite.scala:5)
[error] Failed: Total 1, Failed 1, Errors 0, Passed 0
[error] Failed tests:
[error]   example.HelloSuite
[error] (Test / testQuick) sbt.TestsFailedException: Tests unsuccessful
[error] elapsed time: 1 s, cache 50%, 3 disk cache hits, 3 onsite tasks
</code></pre>
<h3 id="テストが通るようにする"><a class="header" href="#テストが通るようにする">テストが通るようにする</a></h3>
<p>エディタを使って <code>src/test/scala/example/HelloSuite.scala</code> を以下のように変更する:</p>
<pre><code class="language-scala">package example

class HelloSuite extends munit.FunSuite:
  test("Hello should start with H") {
    assert("Hello".startsWith("H"))
  }
end HelloSuite
</code></pre>
<p>テストが通過したことを確認して、<code>Enter</code> を押して継続的テストを抜ける。</p>
<h3 id="ライブラリ依存性を追加する"><a class="header" href="#ライブラリ依存性を追加する">ライブラリ依存性を追加する</a></h3>
<p>エディタを使って、<code>build.sbt</code> を以下のように変更する:</p>
<pre><code class="language-scala">scalaVersion := "3.3.3"
organization := "com.example"
name := "Hello"
libraryDependencies ++= Seq(
  "org.scala-lang" %% "toolkit" % "0.1.7",
  "org.scala-lang" %% "toolkit-test" % "0.1.7" % Test,
)
</code></pre>
<p><code>reload</code> コマンドを使って、<code>build.sbt</code> の変更を反映させる。</p>
<h3 id="scala-repl-を使う"><a class="header" href="#scala-repl-を使う">Scala REPL を使う</a></h3>
<p>New York の現在の天気を調べてみる。</p>
<pre><code class="language-scala">sbt:Hello&gt; console
Welcome to Scala 3.3.3 (1.8.0_402, Java OpenJDK 64-Bit Server VM).
Type in expressions for evaluation. Or try :help.

scala&gt;
import sttp.client4.quick.*
import sttp.client4.Response

val newYorkLatitude: Double = 40.7143
val newYorkLongitude: Double = -74.006
val response: Response[String] = quickRequest
  .get(
    uri"https://api.open-meteo.com/v1/forecast?latitude=\$newYorkLatitude&amp;longitude=\$newYorkLongitude&amp;current_weather=true"
  )
  .send()

println(ujson.read(response.body).render(indent = 2))

// press Ctrl+D

// Exiting paste mode, now interpreting.

{
  "latitude": 40.710335,
  "longitude": -73.99307,
  "generationtime_ms": 0.36704540252685547,
  "utc_offset_seconds": 0,
  "timezone": "GMT",
  "timezone_abbreviation": "GMT",
  "elevation": 51,
  "current_weather": {
    "temperature": 21.3,
    "windspeed": 16.7,
    "winddirection": 205,
    "weathercode": 3,
    "is_day": 1,
    "time": "2023-08-04T10:00"
  }
}
import sttp.client4.quick._
import sttp.client4.Response
val newYorkLatitude: Double = 40.7143
val newYorkLongitude: Double = -74.006
val response: sttp.client4.Response[String] = Response({"latitude":40.710335,"longitude":-73.99307,"generationtime_ms":0.36704540252685547,"utc_offset_seconds":0,"timezone":"GMT","timezone_abbreviation":"GMT","elevation":51.0,"current_weather":{"temperature":21.3,"windspeed":16.7,"winddirection":205.0,"weathercode":3,"is_day":1,"time":"2023-08-04T10:00"}},200,,List(:status: 200, content-encoding: deflate, content-type: application/json; charset=utf-8, date: Fri, 04 Aug 2023 10:09:11 GMT),List(),RequestMetadata(GET,https://api.open-meteo.com/v1/forecast?latitude=40.7143&amp;longitude...

scala&gt; :q // to quit
</code></pre>
<h3 id="サブプロジェクトを作成する"><a class="header" href="#サブプロジェクトを作成する">サブプロジェクトを作成する</a></h3>
<p><code>build.sbt</code> を以下のように変更する:</p>
<pre><code class="language-scala">scalaVersion := "3.3.3"
organization := "com.example"

lazy val hello = project
  .in(file("."))
  .settings(
    name := "Hello",
    libraryDependencies ++= Seq(
      "org.scala-lang" %% "toolkit" % "0.1.7",
      "org.scala-lang" %% "toolkit-test" % "0.1.7" % Test
    )
  )

lazy val helloCore = project
  .in(file("core"))
  .settings(
    name := "Hello Core"
  )
</code></pre>
<p><code>reload</code> コマンドを使って、<code>build.sbt</code> の変更を反映させる。</p>
<h3 id="全てのサブプロジェクトを列挙する"><a class="header" href="#全てのサブプロジェクトを列挙する">全てのサブプロジェクトを列挙する</a></h3>
<pre><code>sbt:Hello&gt; projects
[info] In file:/tmp/foo-build/
[info]   * hello
[info]     helloCore
</code></pre>
<h3 id="サブプロジェクトをコンパイルする"><a class="header" href="#サブプロジェクトをコンパイルする">サブプロジェクトをコンパイルする</a></h3>
<pre><code>sbt:Hello&gt; helloCore/compile
</code></pre>
<h3 id="サブプロジェクトに-toolkit-test-を追加する"><a class="header" href="#サブプロジェクトに-toolkit-test-を追加する">サブプロジェクトに toolkit-test を追加する</a></h3>
<p><code>build.sbt</code> を以下のように変更する:</p>
<pre><code class="language-scala">scalaVersion := "3.3.3"
organization := "com.example"

val toolkitTest = "org.scala-lang" %% "toolkit-test" % "0.1.7"

lazy val hello = project
  .in(file("."))
  .settings(
    name := "Hello",
    libraryDependencies ++= Seq(
      "org.scala-lang" %% "toolkit" % "0.1.7",
      toolkitTest % Test
    )
  )

lazy val helloCore = project
  .in(file("core"))
  .settings(
    name := "Hello Core",
    libraryDependencies += toolkitTest % Test
  )
</code></pre>
<h3 id="コマンドをブロードキャストする"><a class="header" href="#コマンドをブロードキャストする">コマンドをブロードキャストする</a></h3>
<p><code>hello</code> に送ったコマンドを <code>helloCore</code> にもブロードキャストするために集約を設定する:</p>
<pre><code class="language-scala">scalaVersion := "3.3.3"
organization := "com.example"

val toolkitTest = "org.scala-lang" %% "toolkit-test" % "0.1.7"

lazy val hello = project
  .in(file("."))
  .aggregate(helloCore)
  .settings(
    name := "Hello",
    libraryDependencies ++= Seq(
      "org.scala-lang" %% "toolkit" % "0.1.7",
      toolkitTest % Test
    )
  )

lazy val helloCore = project
  .in(file("core"))
  .settings(
    name := "Hello Core",
    libraryDependencies += toolkitTest % Test
  )
</code></pre>
<p><code>reload</code> 後、<code>~test</code> は両方のサブプロジェクトに作用する:</p>
<pre><code class="language-scala">sbt:Hello&gt; ~test
</code></pre>
<p><code>Enter</code> を押して継続的テストを抜ける。</p>
<h3 id="hello-が-hellocore-に依存するようにする"><a class="header" href="#hello-が-hellocore-に依存するようにする">hello が helloCore に依存するようにする</a></h3>
<p>サブプロジェクト間の依存関係を定義するには <code>.dependsOn(...)</code> を使う。ついでに、toolkit への依存性も <code>helloCore</code> に移そう。</p>
<pre><code class="language-scala">scalaVersion := "3.3.3"
organization := "com.example"

val toolkitTest = "org.scala-lang" %% "toolkit-test" % "0.1.7"

lazy val hello = project
  .in(file("."))
  .aggregate(helloCore)
  .dependsOn(helloCore)
  .settings(
    name := "Hello",
    libraryDependencies += toolkitTest % Test
  )

lazy val helloCore = project
  .in(file("core"))
  .settings(
    name := "Hello Core",
    libraryDependencies += "org.scala-lang" %% "toolkit" % "0.1.7",
    libraryDependencies += toolkitTest % Test
  )
</code></pre>
<h3 id="ujson-を使って-json-をパースする"><a class="header" href="#ujson-を使って-json-をパースする">uJson を使って JSON をパースする</a></h3>
<p><code>helloCore</code> に uJson を追加しよう。</p>
<p><code>core/src/main/scala/example/core/Weather.scala</code> を追加する:</p>
<pre><code class="language-scala">package example.core

import sttp.client4.quick._
import sttp.client4.Response

object Weather:
  def temp() =
    val response: Response[String] = quickRequest
      .get(
        uri"https://api.open-meteo.com/v1/forecast?latitude=40.7143&amp;longitude=-74.006&amp;current_weather=true"
      )
      .send()
    val json = ujson.read(response.body)
    json.obj("current_weather")("temperature").num
end Weather
</code></pre>
<p>次に <code>src/main/scala/example/Hello.scala</code> を以下のように変更する:</p>
<pre><code class="language-scala">package example

import example.core.Weather

@main def main(args: String*): Unit =
  val temp = Weather.temp()
  println(s"Hello! The current temperature in New York is $temp C.")
</code></pre>
<p>アプリを走らせてみて、うまくいったか確認する:</p>
<pre><code>sbt:Hello&gt; run
[info] compiling 1 Scala source to /tmp/foo-build/core/target/scala-2.13/classes ...
[info] compiling 1 Scala source to /tmp/foo-build/target/scala-2.13/classes ...
[info] running example.Hello
Hello! The current temperature in New York is 22.7 C.
</code></pre>
<!--
### Add sbt-native-packager plugin

Using an editor, create `project/plugins.sbt`:

@@snip [example-weather-plugins]($root$/src/sbt-test/ref/example-weather/changes/plugins.sbt) {}

Next change `build.sbt` as follows to add `JavaAppPackaging`:

@@snip [example-weather-build2]($root$/src/sbt-test/ref/example-weather/changes/build.sbt) {}

### Reload and create a .zip distribution

```
sbt:Hello> reload
...
sbt:Hello> dist
[info] Wrote /private/tmp/foo-build/target/scala-2.13/hello_2.13-0.1.0-SNAPSHOT.pom
[info] Main Scala API documentation to /tmp/foo-build/target/scala-2.13/api...
[info] Main Scala API documentation successful.
[info] Main Scala API documentation to /tmp/foo-build/core/target/scala-2.13/api...
[info] Wrote /tmp/foo-build/core/target/scala-2.13/hello-core_2.13-0.1.0-SNAPSHOT.pom
[info] Main Scala API documentation successful.
[success] All package validations passed
[info] Your package is ready in /tmp/foo-build/target/universal/hello-0.1.0-SNAPSHOT.zip
```

Here's how you can run the packaged app:

```
$ /tmp/someother
$ cd /tmp/someother
$ unzip -o -d /tmp/someother /tmp/foo-build/target/universal/hello-0.1.0-SNAPSHOT.zip
$ ./hello-0.1.0-SNAPSHOT/bin/hello
Hello! The current temperature in New York is 22.7 C.
```

### Dockerize your app

_Note that a Docker daemon will need to be running in order for this to work._

```
sbt:Hello> Docker/publishLocal
....
[info] Built image hello with tags [0.1.0-SNAPSHOT]
```

Here's how to run the Dockerized app:

```
$ docker run hello:0.1.0-SNAPSHOT
Hello! The current temperature in New York is 22.7 C.
```

### Set the version

Change `build.sbt` as follows:

@@snip [example-weather-build3]($root$/src/sbt-test/ref/example-weather/changes/build3.sbt) {}

-->
<h3 id="一時的に-scalaversion-を変更する"><a class="header" href="#一時的に-scalaversion-を変更する">一時的に scalaVersion を変更する</a></h3>
<pre><code>sbt:Hello&gt; ++3.3.3!
[info] Forcing Scala version to 3.3.3 on all projects.
[info] Reapplying settings...
[info] Set current project to Hello (in build file:/tmp/foo-build/)
</code></pre>
<p><code>scalaVersion</code> セッティングを確認する:</p>
<pre><code>sbt:Hello&gt; scalaVersion
[info] helloCore / scalaVersion
[info]  3.3.3
[info] scalaVersion
[info]  3.3.3
</code></pre>
<p>このセッティングは <code>reload</code> 後には無効となる。</p>
<!--
### Inspect the dist task

To find out more about `dist`, try `help` and `inspect`.

```scala
sbt:Hello> help dist
Creates the distribution packages.
sbt:Hello> inspect dist
```

To call inspect recursively on the dependency tasks use `inspect tree`.

```scala
sbt:Hello> inspect tree dist
[info] dist = Task[java.io.File]
[info]   +-Universal / dist = Task[java.io.File]
....
```

-->
<h3 id="バッチモード"><a class="header" href="#バッチモード">バッチ・モード</a></h3>
<p>sbt のコマンドをターミナルから直接渡して sbt をバッチモードで実行することができる。</p>
<pre><code>$ sbt clean "testOnly HelloSuite"
</code></pre>
<h3 id="sbt-new-コマンド"><a class="header" href="#sbt-new-コマンド">sbt new コマンド</a></h3>
<p>sbt <code>new</code> コマンドを使って手早く簡単な Hello world ビルドをセットアップすることができる。</p>
<pre><code>$ sbt new scala/scala-seed.g8
....
A minimal Scala project.

name [My Something Project]: hello

Template applied in ./hello
</code></pre>
<p>プロジェクト名を入力するプロンプトが出てきたら <code>hello</code> と入力する。</p>
<p>これで、<code>hello</code> ディレクトリ以下に新しいプロジェクトができた。</p>
<h3 id="クレジット"><a class="header" href="#クレジット">クレジット</a></h3>
<p>本ページは William “Scala William” Narmontas さん作の <a href="https://www.scalawilliam.com/essential-sbt/">Essential sbt</a> というチュートリアルに基づいて書かれた。</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="Setup.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="guide/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="Setup.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="guide/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>