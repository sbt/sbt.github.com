<!DOCTYPE html SYSTEM "about:legacy-compat">
<html>
      <head>
        <meta charset="utf-8"/>
        <meta content="width=device-width, initial-scale=1" name="viewport"/>
        <title>sbt Reference Manual — Tasks</title>
        <link rel="shortcut icon" href="favicon.ico"/>
        <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css"/>
        <link rel="stylesheet" href="css/pamflet.css" type="text/css" media="screen, projection"/>
        <link rel="stylesheet" href="css/pamflet-print.css" type="text/css" media="print"/>
        <link rel="stylesheet" href="css/pamflet-grid.css" type="text/css" media="screen and (min-device-width: 800px), projection"/>
        <link rel="stylesheet" href="css/color_scheme-redmond.css" type="text/css" media="screen, projection"/>
        <link rel="stylesheet" href="css/color_scheme-github.css" type="text/css" media="screen, projection"/>
        <link rel="stylesheet" href="css/color_scheme-monokai.css" type="text/css" media="screen, projection"/>
        <link rel="stylesheet" href="css/pamfletheight_80px_2em.css" type="text/css" media="screen and (min-device-width: 800px), projection"/>
        <script type="text/javascript" src="js/jquery-3.3.1.min.js"></script>
        <script type="text/javascript" src="js/bootstrap.bundle.min.js"></script>
        <script type="text/javascript" src="js/pamflet.js"></script>
        <script type="text/javascript">
          Pamflet.page.language = 'en';
        </script>
        <script type="text/javascript" src="js/prettify/prettify.js"></script><script type="text/javascript" src="js/prettify/lang-scala.js"></script><link type="text/css" rel="stylesheet" href="css/prettify.css"/><script type="text/javascript"><!--
        window.onload=function() { prettyPrint(); };
      --></script>
        <link rel="stylesheet" href="css/custom-202107.css" type="text/css" media="screen, projection"/>
        
        <script type="text/javascript">
              Pamflet.twitter = '#sbt #scala';
            </script>
      </head>
      <body class="color_scheme-github">
        <div class="container-fluid contentswrapper h-100">
          <div class="row minh-100">
          <div class="col-md-4 col-xl-3 toccolumn leftcolumn">
                  <div class="lefttocwrapper">
      <div class="tocwrapper">
        
        <div class="tocbody show" id="toc">
        
        <div><a href="index.html">sbt Reference Manual</a></div><ol class="toc"> <li><div><a href="Getting-Started.html">Getting Started with sbt</a></div><ol class="toc"> <li><div><a href="Setup.html">Installing sbt</a></div><ol class="toc"> <li><div><a href="Installing-sbt-on-Mac.html">Installing sbt on macOS</a></div></li><li><div><a href="Installing-sbt-on-Windows.html">Installing sbt on Windows</a></div></li><li><div><a href="Installing-sbt-on-Linux.html">Installing sbt on Linux</a></div></li> </ol></li><li><div><a href="sbt-by-example.html">sbt by example</a></div></li><li><div><a href="Directories.html">Directory structure</a></div></li><li><div><a href="Running.html">Running</a></div></li><li><div><a href="IDE.html">IDE Integration</a></div></li><li><div><a href="Basic-Def.html">Build definition</a></div></li><li><div><a href="Multi-Project.html">Multi-project builds</a></div></li><li><div><a href="Task-Graph.html">Task graph</a></div></li><li><div><a href="Scopes.html">Scopes</a></div></li><li><div><a href="Appending-Values.html">Appending values</a></div></li><li><div><a href="Scope-Delegation.html">Scope delegation (.value lookup)</a></div></li><li><div><a href="Library-Dependencies.html">Library dependencies</a></div></li><li><div><a href="Using-Plugins.html">Using plugins</a></div></li><li><div><a href="Custom-Settings.html">Custom settings and tasks</a></div></li><li><div><a href="Organizing-Build.html">Organizing the build</a></div></li><li><div><a href="Summary.html">Getting Started summary</a></div></li> </ol></li><li><div><a href="Faq.html">Frequently Asked Questions</a></div><ol class="toc">  </ol></li><li><div><a href="General-Info.html">General Information</a></div><ol class="toc"> <li><div><a href="Credits.html">Credits</a></div></li><li><div><a href="Community-Plugins.html">Community Plugins</a></div></li><li><div><a href="Repository-Roles.html">Community Repository Policy</a></div></li><li><div><a href="Bintray-For-Plugins.html">Bintray For Plugins</a></div></li><li><div><a href="Using-Sonatype.html">Using Sonatype</a></div></li><li><div><a href="Contributing-to-sbt.html">Contributing to sbt</a></div></li><li><div><a href="Changes.html">Changes</a></div><ol class="toc"> <li><div><a href="Migrating-from-sbt-013x.html">Migrating from sbt 0.13.x</a></div></li><li><div><a href="sbt-1.4-Release-Notes.html">sbt 1.4.x releases</a></div></li><li><div><a href="sbt-1.3-Release-Notes.html">sbt 1.3.x releases</a></div></li><li><div><a href="sbt-1.2-Release-Notes.html">sbt 1.2.x releases</a></div></li><li><div><a href="sbt-1.1-Release-Notes.html">sbt 1.1.x releases</a></div></li><li><div><a href="sbt-1.0-Release-Notes.html">sbt 1.0.x releases</a></div></li> </ol></li> </ol></li><li><div><a href="Detailed-Topics.html">Detailed Topics</a></div><ol class="toc"> <li><div><a href="Using-sbt.html">Using sbt</a></div><ol class="toc"> <li><div><a href="Command-Line-Reference.html">Command Line Reference</a></div></li><li><div><a href="Console-Project.html">Console Project</a></div></li><li><div><a href="Cross-Build.html">Cross-building</a></div></li><li><div><a href="Inspecting-Settings.html">Interacting with the Configuration System</a></div></li><li><div><a href="Triggered-Execution.html">Triggered Execution</a></div></li><li><div><a href="Scripts.html">Script mode</a></div></li><li><div><a href="sbt-server.html">sbt Server</a></div></li><li><div><a href="Understanding-Recompilation.html">Understanding Incremental Recompilation</a></div></li> </ol></li><li><div><a href="Configuration-Index.html">Configuration</a></div><ol class="toc"> <li><div><a href="Classpaths.html">Classpaths, sources, and resources</a></div></li><li><div><a href="Compiler-Plugins.html">Compiler Plugin Support</a></div></li><li><div><a href="Configuring-Scala.html">Configuring Scala</a></div></li><li><div><a href="Forking.html">Forking</a></div></li><li><div><a href="Global-Settings.html">Global Settings</a></div></li><li><div><a href="Java-Sources.html">Java Sources</a></div></li><li><div><a href="Mapping-Files.html">Mapping Files</a></div></li><li><div><a href="Local-Scala.html">Local Scala</a></div></li><li><div><a href="Macro-Projects.html">Macro Projects</a></div></li><li><div><a href="Paths.html">Paths</a></div></li><li><div><a href="Parallel-Execution.html">Parallel Execution</a></div></li><li><div><a href="Process.html">External Processes</a></div></li><li><div><a href="Running-Project-Code.html">Running Project Code</a></div></li><li><div><a href="Testing.html">Testing</a></div></li><li><div><a href="In-Process-Classloaders.html">In process class loading</a></div></li><li><div><a href="Globs.html">Globs</a></div></li><li><div><a href="Remote-Caching.html">Remote Caching</a></div></li> </ol></li><li><div><a href="Dependency-Management-Index.html">Dependency Management</a></div><ol class="toc"> <li><div><a href="Artifacts.html">Artifacts</a></div></li><li><div><a href="Dependency-Management-Flow.html">Dependency Management Flow</a></div></li><li><div><a href="Library-Management.html">Library Management</a></div></li><li><div><a href="Proxy-Repositories.html">Proxy Repositories</a></div></li><li><div><a href="Publishing.html">Publishing</a></div></li><li><div><a href="Resolvers.html">Resolvers</a></div></li><li><div><a href="Update-Report.html">Update Report</a></div></li><li><div><a href="Cached-Resolution.html">Cached Resolution</a></div></li> </ol></li><li><div><a href="Tasks-and-Commands.html">Tasks and Commands</a></div><ol class="toc"> <li><div class="current">Tasks</div></li><li><div><a href="Caching.html">Caching</a></div></li><li><div><a href="Input-Tasks.html">Input Tasks</a></div></li><li><div><a href="Commands.html">Commands</a></div></li><li><div><a href="Parsing-Input.html">Parsing and tab completion</a></div></li><li><div><a href="Build-State.html">State and actions</a></div></li><li><div><a href="Task-Inputs.html">Tasks/Settings: Motivation</a></div></li> </ol></li><li><div><a href="Plugins-and-Best-Practices.html">Plugins and Best Practices</a></div><ol class="toc"> <li><div><a href="Best-Practices.html">General Best Practices</a></div></li><li><div><a href="Plugins.html">Plugins</a></div></li><li><div><a href="Plugins-Best-Practices.html">Plugins Best Practices</a></div></li><li><div><a href="GitHub-Actions-with-sbt.html">Setting up GitHub Actions with sbt</a></div></li><li><div><a href="Travis-CI-with-sbt.html">Setting up Travis CI with sbt</a></div></li><li><div><a href="Testing-sbt-plugins.html">Testing sbt plugins</a></div></li><li><div><a href="sbt-new-and-Templates.html">sbt new and Templates</a></div></li><li><div><a href="Cross-Build-Plugins.html">Cross building plugins</a></div></li> </ol></li> </ol></li><li><div><a href="Howto.html">How to…</a></div><ol class="toc"> <li><div><a href="Howto-Classpaths.html">Classpaths</a></div></li><li><div><a href="Howto-Customizing-Paths.html">Customizing paths</a></div></li><li><div><a href="Howto-Generating-Files.html">Generating files</a></div></li><li><div><a href="Howto-Inspect-the-Build.html">Inspect the build</a></div></li><li><div><a href="Howto-Interactive-Mode.html">Interactive mode</a></div></li><li><div><a href="Howto-Logging.html">Configure and use logging</a></div></li><li><div><a href="Howto-Project-Metadata.html">Project metadata</a></div></li><li><div><a href="Howto-Package.html">Configure packaging</a></div></li><li><div><a href="Howto-Running-Commands.html">Running commands</a></div></li><li><div><a href="Howto-Scala.html">Configure and use Scala</a></div></li><li><div><a href="Howto-Scaladoc.html">Generate API documentation</a></div></li><li><div><a href="Define+Custom+Tasks.html">Define Custom Tasks</a></div></li><li><div><a href="Howto-Startup.html">How to take an action on startup</a></div></li><li><div><a href="Howto-Track-File-Inputs-and-Outputs.html">Track file inputs and outputs</a></div></li><li><div><a href="Troubleshoot-Memory-Issues.html">Troubleshoot memory issues</a></div></li><li><div><a href="Howto-Sequencing.html">Sequencing</a></div><ol class="toc"> <li><div><a href="Howto-Sequential-Task.html">Defining a sequential task with Def.sequential</a></div></li><li><div><a href="Howto-Dynamic-Task.html">Defining a dynamic task with Def.taskDyn</a></div></li><li><div><a href="Howto-After-Input-Task.html">Doing something after an input task</a></div></li><li><div><a href="Howto-Dynamic-Input-Task.html">Defining a dynamic input task with Def.inputTaskDyn</a></div></li><li><div><a href="Howto-Sequence-using-Commands.html">How to sequence using commands</a></div></li> </ol></li><li><div><a href="Custom-Dependency-Configuration.html">How to define a custom dependency configuration</a></div></li><li><div><a href="Examples.html">Examples</a></div><ol class="toc"> <li><div><a href="Basic-Def-Examples.html">.sbt build examples</a></div></li><li><div><a href="Scala-Files-Example.html">.sbt build with .scala files example</a></div></li><li><div><a href="Advanced-Configurations-Example.html">Advanced configurations example</a></div></li><li><div><a href="Advanced-Command-Example.html">Advanced command example</a></div></li> </ol></li> </ol></li><li><div><a href="Name-Index.html">Index</a></div></li><li><div><a href="Developers-Guide.html">Developer’s Guide (Work in progress)</a></div><ol class="toc"> <li><div><a href="Modularization.html">Modularization</a></div><ol class="toc"> <li><div><a href="Module-Summary.html">Module summary</a></div></li> </ol></li><li><div><a href="Coding-Guideline.html">sbt Coding Guideline</a></div><ol class="toc">  </ol></li><li><div><a href="Datatype.html">sbt-datatype</a></div><ol class="toc">  </ol></li><li><div><a href="Compiler-Interface.html">Compiler Interface</a></div><ol class="toc"> <li><div><a href="Version-Specific-Sources.html">Fetching the most specific sources</a></div></li> </ol></li><li><div><a href="Sbt-Launcher.html">sbt Launcher</a></div><ol class="toc"> <li><div><a href="Launcher-Getting-Started.html">Getting Started with the sbt launcher</a></div></li><li><div><a href="Launcher-Architecture.html">Sbt Launcher Architecture</a></div></li><li><div><a href="Launcher-Configuration.html">sbt Launcher Configuration</a></div></li> </ol></li><li><div><a href="DevGuide-Notes.html">Notes</a></div><ol class="toc"> <li><div><a href="Core-Principles.html">Core Principles</a></div></li><li><div><a href="Settings-Core.html">Settings Core</a></div></li><li><div><a href="Setting-Initialization.html">Setting Initialization</a></div></li><li><div><a href="Command-Line-Applications.html">Creating Command Line Applications Using sbt</a></div></li> </ol></li> </ol></li><li class="generated"><div><a href="Contents+in+Depth.html">Contents in Depth</a></div></li><li class="generated"><div><a href="Combined+Pages.html">Combined Pages</a></div></li> </ol></div>
      </div>
      </div>
                </div><div class="col-md-8 col-xs-9">
                  <div class="rightcolumn contents">
                  <h2 id="Tasks">Tasks<a href="#Tasks" class="header-link"><span class="header-link-content">&nbsp;</span></a></h2><p>Tasks and settings are introduced in the
<a href="Basic-Def.html">getting started guide</a>, which you may wish
to read first. This page has additional details and background and is
intended more as a reference.
</p><h3 id="Introduction">Introduction<a href="#Introduction" class="header-link"><span class="header-link-content">&nbsp;</span></a></h3><p>Both settings and tasks produce values, but there are two major
differences between them:
</p><ol><li>Settings are evaluated at project load time. Tasks are executed on
demand, often in response to a command from the user.
</li><li>At the beginning of project loading, settings and their dependencies
are fixed. Tasks can introduce new tasks during execution, however.
</li></ol><h3 id="Features">Features<a href="#Features" class="header-link"><span class="header-link-content">&nbsp;</span></a></h3><p>There are several features of the task system:
</p><ol><li>By integrating with the settings system, tasks can be added,
removed, and modified as easily and flexibly as settings.
</li><li><a href="Input-Tasks.html">Input Tasks</a> use
<a href="Parsing-Input.html">parser combinators</a> to define the syntax for their
arguments. This allows flexible syntax and tab-completions in the
same way as <a href="Commands.html">Commands</a>.
</li><li>Tasks produce values. Other tasks can access a task’s value by
calling <code>value</code> on it within a task definition.
</li><li>Dynamically changing the structure of the task graph is possible.
Tasks can be injected into the execution graph based on the result
of another task.
</li><li>There are ways to handle task failure, similar to
<code>try/catch/finally</code>.
</li><li>Each task has access to its own Logger that by default persists the
logging for that task at a more verbose level than is initially
printed to the screen.
</li></ol><p>These features are discussed in detail in the following sections.
</p><h3 id="Defining+a+Task">Defining a Task<a href="#Defining+a+Task" class="header-link"><span class="header-link-content">&nbsp;</span></a></h3><h4 id="Hello+World+example+%28sbt%29">Hello World example (sbt)<a href="#Hello+World+example+%28sbt%29" class="header-link"><span class="header-link-content">&nbsp;</span></a></h4><p><code>build.sbt</code>:
</p><pre><code class="prettyprint lang-scala">lazy val hello = taskKey[Unit](&quot;Prints 'Hello World'&quot;)

hello := println(&quot;hello world!&quot;)
</code></pre><p>Run “sbt hello” from command line to invoke the task. Run “sbt tasks” to
see this task listed.
</p><h4 id="Define+the+key">Define the key<a href="#Define+the+key" class="header-link"><span class="header-link-content">&nbsp;</span></a></h4><p>To declare a new task, define a lazy val of type <code>TaskKey</code>:
</p><pre><code class="prettyprint lang-scala">lazy val sampleTask = taskKey[Int](&quot;A sample task.&quot;)
</code></pre><p>The name of the <code>val</code> is used when referring to the task in Scala code
and at the command line. The string passed to the <code>taskKey</code> method is a
description of the task. The type parameter passed to <code>taskKey</code> (here,
<code>Int</code>) is the type of value produced by the task.
</p><p>We’ll define a couple of other keys for the examples:
</p><pre><code class="prettyprint lang-scala">lazy val intTask = taskKey[Int](&quot;An int task&quot;)
lazy val stringTask = taskKey[String](&quot;A string task&quot;)
</code></pre><p>The examples themselves are valid entries in a <code>build.sbt</code> or can be
provided as part of a sequence to <code>Project.settings</code> (see
<a href="Full-Def.html">.scala build definition</a>).
</p><h4 id="Implement+the+task">Implement the task<a href="#Implement+the+task" class="header-link"><span class="header-link-content">&nbsp;</span></a></h4><p>There are three main parts to implementing a task once its key is
defined:
</p><ol><li>Determine the settings and other tasks needed by the task. They are
the task’s inputs.
</li><li>Define the code that implements the task in terms of these inputs.
</li><li>Determine the scope the task will go in.
</li></ol><p>These parts are then combined just like the parts of a setting are
combined.
</p><h5 id="Defining+a+basic+task">Defining a basic task<a href="#Defining+a+basic+task" class="header-link"><span class="header-link-content">&nbsp;</span></a></h5><p>A task is defined using <code>:=</code>
</p><pre><code class="prettyprint lang-scala">intTask := 1 + 2

stringTask := System.getProperty(&quot;user.name&quot;)

sampleTask := {
   val sum = 1 + 2
   println(&quot;sum: &quot; + sum)
   sum
}
</code></pre><p>As mentioned in the introduction, a task is evaluated on demand. Each
time <code>sampleTask</code> is invoked, for example, it will print the sum. If the
username changes between runs, <code>stringTask</code> will take different values
in those separate runs. (Within a run, each task is evaluated at most
once.) In contrast, settings are evaluated once on project load and are
fixed until the next reload.
</p><h5 id="Tasks+with+inputs">Tasks with inputs<a href="#Tasks+with+inputs" class="header-link"><span class="header-link-content">&nbsp;</span></a></h5><p>Tasks with other tasks or settings as inputs are also defined using
<code>:=</code>. The values of the inputs are referenced by the <code>value</code> method.
This method is special syntax and can only be called when defining a
task, such as in the argument to <code>:=</code>. The following defines a task that
adds one to the value produced by <code>intTask</code> and returns the result.
</p><pre><code class="prettyprint lang-scala">sampleTask := intTask.value + 1
</code></pre><p>Multiple settings are handled similarly:
</p><pre><code class="prettyprint lang-scala">stringTask := &quot;Sample: &quot; + sampleTask.value + &quot;, int: &quot; + intTask.value
</code></pre><h5 id="Task+Scope">Task Scope<a href="#Task+Scope" class="header-link"><span class="header-link-content">&nbsp;</span></a></h5><p>As with settings, tasks can be defined in a specific scope. For example,
there are separate <code>compile</code> tasks for the <code>compile</code> and <code>test</code> scopes.
The scope of a task is defined the same as for a setting. In the
following example, <code>Test/sampleTask</code> uses the result of
<code>Compile/intTask</code>.
</p><pre><code class="prettyprint lang-scala">Test / sampleTask := (Compile / intTask).value * 3
</code></pre><h5 id="On+precedence">On precedence<a href="#On+precedence" class="header-link"><span class="header-link-content">&nbsp;</span></a></h5><p>As a reminder, infix method precedence is by the name of the method and
postfix methods have lower precedence than infix methods.
</p><ol><li>Assignment methods have the lowest precedence. These are methods
with names ending in <code>=</code>, except for <code>!=</code>, <code>&lt;=</code>, <code>&gt;=</code>, and names that
start with <code>=</code>.
</li><li>Methods starting with a letter have the next highest precedence.
</li><li><p>Methods with names that start with a symbol and aren’t included in
</p><ol><li>have the highest precedence. (This category is divided further
according to the specific character it starts with. See the Scala
specification for details.)
</li></ol></li></ol><p>Therefore, the previous example is equivalent to the following:
</p><pre><code class="prettyprint lang-scala">(Test / sampleTask).:=( (Compile / intTask).value * 3 )
</code></pre><p>Additionally, the braces in the following are necessary:
</p><pre><code class="prettyprint lang-scala">helloTask := { &quot;echo Hello&quot; ! }
</code></pre><p>Without them, Scala interprets the line as
<code>( helloTask.:=(&quot;echo Hello&quot;) ).!</code> instead of the desired
<code>helloTask.:=( &quot;echo Hello&quot;.! )</code>.
</p><h4 id="Separating+implementations">Separating implementations<a href="#Separating+implementations" class="header-link"><span class="header-link-content">&nbsp;</span></a></h4><p>The implementation of a task can be separated from the binding. For
example, a basic separate definition looks like:
</p><pre><code class="prettyprint lang-scala">// Define a new, standalone task implemention
lazy val intTaskImpl: Initialize[Task[Int]] =
   Def.task { sampleTask.value - 3 }

// Bind the implementation to a specific key
intTask := intTaskImpl.value
</code></pre><p>Note that whenever <code>.value</code> is used, it must be within a task
definition, such as within <code>Def.task</code> above or as an argument to <code>:=</code>.
</p><h4 id="Modifying+an+Existing+Task">Modifying an Existing Task<a href="#Modifying+an+Existing+Task" class="header-link"><span class="header-link-content">&nbsp;</span></a></h4><p>In the general case, modify a task by declaring the previous task as an
input.
</p><pre><code class="prettyprint lang-scala">// initial definition
intTask := 3

// overriding definition that references the previous definition
intTask := intTask.value + 1
</code></pre><p>Completely override a task by not declaring the previous task as an
input. Each of the definitions in the following example completely
overrides the previous one. That is, when <code>intTask</code> is run, it will only
print <code>#3</code>.
</p><pre><code class="prettyprint lang-scala">intTask := {
    println(&quot;#1&quot;)
    3
}

intTask := {
    println(&quot;#2&quot;)
    5
}

intTask :=  {
    println(&quot;#3&quot;)
    sampleTask.value - 3
}
</code></pre><a name="multiple-scopes"></a><h3 id="Getting+values+from+multiple+scopes">Getting values from multiple scopes<a href="#Getting+values+from+multiple+scopes" class="header-link"><span class="header-link-content">&nbsp;</span></a></h3><h4 id="Introduction">Introduction<a href="#Introduction" class="header-link"><span class="header-link-content">&nbsp;</span></a></h4><p>The general form of an expression that gets values from multiple scopes
is:
</p><pre><code class="prettyprint lang-scala">&lt;setting-or-task&gt;.all(&lt;scope-filter&gt;).value
</code></pre><p><strong>NOTE!</strong> Make sure to assign the <code>ScopeFilter</code> as a <code>val</code>!  This is an
implementation detail requirement of the <code>.all</code> macro.
</p><p>The <code>all</code> method is implicitly added to tasks and settings. It accepts a
<code>ScopeFilter</code> that will select the <code>Scopes</code>. The result has type
<code>Seq[T]</code>, where <code>T</code> is the key’s underlying type.
</p><h4 id="Example">Example<a href="#Example" class="header-link"><span class="header-link-content">&nbsp;</span></a></h4><p>A common scenario is getting the sources for all subprojects for
processing all at once, such as passing them to scaladoc. The task that
we want to obtain values for is <code>sources</code> and we want to get the values
in all non-root projects and in the <code>Compile</code> configuration. This looks
like:
</p><pre><code class="prettyprint lang-scala">lazy val core = project

lazy val util = project

val filter = ScopeFilter( inProjects(core, util), inConfigurations(Compile) )

lazy val root = project.settings(
   sources := {
      // each sources definition is of type Seq[File],
      //   giving us a Seq[Seq[File]] that we then flatten to Seq[File]
      val allSources: Seq[Seq[File]] = sources.all(filter).value
      allSources.flatten
   }
)
</code></pre><p>The next section describes various ways to construct a ScopeFilter.
</p><h4 id="ScopeFilter">ScopeFilter<a href="#ScopeFilter" class="header-link"><span class="header-link-content">&nbsp;</span></a></h4><p>A basic <code>ScopeFilter</code> is constructed by the <code>ScopeFilter.apply</code> method.
This method makes a <code>ScopeFilter</code> from filters on the parts of a
<code>Scope</code>: a <code>ProjectFilter</code>, <code>ConfigurationFilter</code>, and <code>TaskFilter</code>. The
simplest case is explicitly specifying the values for the parts:
</p><pre><code class="prettyprint lang-scala">val filter: ScopeFilter =
   ScopeFilter(
      inProjects( core, util ),
      inConfigurations( Compile, Test )
   )
</code></pre><h5 id="Unspecified+filters">Unspecified filters<a href="#Unspecified+filters" class="header-link"><span class="header-link-content">&nbsp;</span></a></h5><p>If the task filter is not specified, as in the example above, the
default is to select scopes without a specific task (global). Similarly,
an unspecified configuration filter will select scopes in the global
configuration. The project filter should usually be explicit, but if
left unspecified, the current project context will be used.
</p><h5 id="More+on+filter+construction">More on filter construction<a href="#More+on+filter+construction" class="header-link"><span class="header-link-content">&nbsp;</span></a></h5><p>The example showed the basic methods <code>inProjects</code> and
<code>inConfigurations</code>. This section describes all methods for constructing
a <code>ProjectFilter</code>, <code>ConfigurationFilter</code>, or <code>TaskFilter</code>. These methods
can be organized into four groups:
</p><ul><li>Explicit member list (<code>inProjects</code>, <code>inConfigurations</code>, <code>inTasks</code>)
</li><li>Global value (<code>inGlobalProject</code>, <code>inGlobalConfiguration</code>,
<code>inGlobalTask</code>)
</li><li>Default filter (<code>inAnyProject</code>, <code>inAnyConfiguration</code>, <code>inAnyTask</code>)
</li><li>Project relationships (<code>inAggregates</code>, <code>inDependencies</code>)
</li></ul><p>See the <a href="../api/sbt/ScopeFilter$$Make.html">API documentation</a> for
details.
</p><h5 id="Combining+ScopeFilters">Combining ScopeFilters<a href="#Combining+ScopeFilters" class="header-link"><span class="header-link-content">&nbsp;</span></a></h5><p><code>ScopeFilters</code> may be combined with the <code>&amp;&amp;</code>, <code>||</code>, <code>--</code>, and <code>-</code>
methods:
</p><ul><li><code>a &amp;&amp; b</code> Selects scopes that match both a and b
</li><li><code>a || b</code> Selects scopes that match either a or b
</li><li><code>a -- b</code> Selects scopes that match a but not b
</li><li><code>-b</code> Selects scopes that do not match b
</li></ul><p>For example, the following selects the scope for the <code>Compile</code> and
<code>Test</code> configurations of the <code>core</code> project and the global configuration
of the <code>util</code> project:
</p><pre><code class="prettyprint lang-scala">val filter: ScopeFilter =
   ScopeFilter( inProjects(core), inConfigurations(Compile, Test)) ||
   ScopeFilter( inProjects(util), inGlobalConfiguration )
</code></pre><h4 id="More+operations">More operations<a href="#More+operations" class="header-link"><span class="header-link-content">&nbsp;</span></a></h4><p>The <code>all</code> method applies to both settings (values of type
<code>Initialize[T]</code>) and tasks (values of type <code>Initialize[Task[T]]</code>). It
returns a setting or task that provides a <code>Seq[T]</code>, as shown in this
table:
</p><table class="table table-striped">
  <tr>
    <th>Target</th>
    <th>Result</th>
  </tr>

  <tr>
    <td><tt>Initialize[T] </tt></td>
    <td><tt>Initialize[Seq[T]]</tt></td>
  </tr>

  <tr>
    <td><tt>Initialize[Task[T]]</tt></td>
    <td><tt>Initialize[Task[Seq[T]]]</tt></td>
  </tr>
</table><p>This means that the <code>all</code> method can be combined with methods that
construct tasks and settings.
</p><h5 id="Missing+values">Missing values<a href="#Missing+values" class="header-link"><span class="header-link-content">&nbsp;</span></a></h5><p>Some scopes might not define a setting or task. The <code>?</code> and <code>??</code> methods
can help in this case. They are both defined on settings and tasks and
indicate what to do when a key is undefined.
</p><table class="table table-striped">
  <tr>
    <td><tt>?</tt></td>
    <td><tt>On a setting or task with underlying type T, this accepts no
    arguments and returns a setting or task (respectively) of type
    Option[T]. The result is None if the setting/task is undefined and
    Some[T] with the value if it is.</tt></td>
  </tr>

  <tr>
    <td><tt>??</tt></td>
    <td><tt>On a setting or task with underlying type T, this accepts an
    argument of type T and uses this argument if the setting/task is
    undefined.</tt></td>
  </tr>
</table><p>The following contrived example sets the maximum errors to be the
maximum of all aggregates of the current project.
</p><pre><code class="prettyprint lang-scala">// select the transitive aggregates for this project, but not the project itself
val filter: ScopeFilter =
   ScopeFilter( inAggregates(ThisProject, includeRoot=false) )

maxErrors := {
   // get the configured maximum errors in each selected scope,
   // using 0 if not defined in a scope
   val allVersions: Seq[Int] =
      (maxErrors ?? 0).all(filter).value
   allVersions.max
}
</code></pre><h5 id="Multiple+values+from+multiple+scopes">Multiple values from multiple scopes<a href="#Multiple+values+from+multiple+scopes" class="header-link"><span class="header-link-content">&nbsp;</span></a></h5><p>The target of <code>all</code> is any task or setting, including anonymous ones.
This means it is possible to get multiple values at once without
defining a new task or setting in each scope. A common use case is to
pair each value obtained with the project, configuration, or full scope
it came from.
</p><ul><li><code>resolvedScoped</code>: Provides the full enclosing ScopedKey (which is a Scope +
<code>AttributeKey[_]</code>)
</li><li><code>thisProject</code>: Provides the Project associated with this scope (undefined at the
global and build levels)
</li><li><code>thisProjectRef</code>: Provides the ProjectRef for the context (undefined at the global and
build levels)
</li><li><code>configuration</code>: Provides the Configuration for the context (undefined for the global
configuration)
</li></ul><p>For example, the following defines a task that prints non-Compile
configurations that define sbt plugins. This might be used to identify
an incorrectly configured build (or not, since this is a fairly
contrived example):
</p><pre><code class="prettyprint lang-scala">// Select all configurations in the current project except for Compile
lazy val filter: ScopeFilter = ScopeFilter(
   inProjects(ThisProject),
   inAnyConfiguration -- inConfigurations(Compile)
)

// Define a task that provides the name of the current configuration
//   and the set of sbt plugins defined in the configuration
lazy val pluginsWithConfig: Initialize[Task[ (String, Set[String]) ]] =
   Def.task {
      ( configuration.value.name, definedSbtPlugins.value )
   }

checkPluginsTask := {
   val oddPlugins: Seq[(String, Set[String])] =
      pluginsWithConfig.all(filter).value
   // Print each configuration that defines sbt plugins
   for( (config, plugins) &lt;- oddPlugins if plugins.nonEmpty )
      println(s&quot;$config defines sbt plugins: ${plugins.mkString(&quot;, &quot;)}&quot;)
}
</code></pre><h3 id="Advanced+Task+Operations">Advanced Task Operations<a href="#Advanced+Task+Operations" class="header-link"><span class="header-link-content">&nbsp;</span></a></h3><p>The examples in this section use the task keys defined in the previous
section.
</p><h4 id="Streams%3A+Per-task+logging">Streams: Per-task logging<a href="#Streams%3A+Per-task+logging" class="header-link"><span class="header-link-content">&nbsp;</span></a></h4><p>Per-task loggers are part of a more general system for task-specific
data called Streams. This allows controlling the verbosity of stack
traces and logging individually for tasks as well as recalling the last
logging for a task. Tasks also have access to their own persisted binary
or text data.
</p><p>To use Streams, get the value of the <code>streams</code> task. This is a special
task that provides an instance of
<a href="../api/sbt/std/TaskStreams.html">TaskStreams</a> for the defining
task. This type provides access to named binary and text streams, named
loggers, and a default logger. The default
<a href="../api/sbt/util/Logger.html">Logger</a>, which is the most commonly used
aspect, is obtained by the <code>log</code> method:
</p><pre><code class="prettyprint lang-scala">myTask := {
  val s: TaskStreams = streams.value
  s.log.debug(&quot;Saying hi...&quot;)
  s.log.info(&quot;Hello!&quot;)
}
</code></pre><p>You can scope logging settings by the specific task’s scope:
</p><pre><code class="prettyprint lang-scala">myTask / logLevel := Level.Debug

myTask / traceLevel := 5
</code></pre><p>To obtain the last logging output from a task, use the <code>last</code> command:
</p><pre><code class="">$ last myTask
[debug] Saying hi...
[info] Hello!
</code></pre><p>The verbosity with which logging is persisted is controlled using the
<code>persistLogLevel</code> and <code>persistTraceLevel</code> settings. The <code>last</code> command
displays what was logged according to these levels. The levels do not
affect already logged information.
</p><h3 id="Conditional+task">Conditional task<a href="#Conditional+task" class="header-link"><span class="header-link-content">&nbsp;</span></a></h3><p>(Requires sbt 1.4.0+)
</p><p>When <code>Def.task { ... }</code> consists of an <code>if</code>-expression at the top-level, a conditional task (or Selective task) is automatically created:
</p><pre><code class="prettyprint lang-scala">bar := {
  if (number.value &lt; 0) negAction.value
  else if (number.value == 0) zeroAction.value
  else posAction.value
}
</code></pre><p>Unlike the regular (Applicative) task composition, conditional tasks delays the evaluation of then-clause and else-clause as naturally expected of an <code>if</code>-expression. This is already possible with <code>Def.taskDyn { ... }</code>, but unlike dynamic tasks, conditional task works with <code>inspect</code> command.
</p><h3 id="Dynamic+Computations+with">Dynamic Computations with <code>Def.taskDyn</code><a href="#Dynamic+Computations+with" class="header-link"><span class="header-link-content">&nbsp;</span></a></h3><p>It can be useful to use the result of a task to determine the next tasks
to evaluate. This is done using <code>Def.taskDyn</code>. The result of <code>taskDyn</code>
is called a dynamic task because it introduces dependencies at runtime.
The <code>taskDyn</code> method supports the same syntax as <code>Def.task</code> and <code>:=</code>
except that you return a task instead of a plain value.
</p><p>For example,
</p><pre><code class="prettyprint lang-scala">val dynamic = Def.taskDyn {
  // decide what to evaluate based on the value of `stringTask`
  if(stringTask.value == &quot;dev&quot;)
    // create the dev-mode task: this is only evaluated if the
    //   value of stringTask is &quot;dev&quot;
    Def.task {
      3
    }
  else
    // create the production task: only evaluated if the value
    //    of the stringTask is not &quot;dev&quot;
    Def.task {
      intTask.value + 5
    }
}

myTask := {
  val num = dynamic.value
  println(s&quot;Number selected was $num&quot;)
}
</code></pre><p>The only static dependency of <code>myTask</code> is <code>stringTask</code>. The dependency
on <code>intTask</code> is only introduced in non-dev mode.
</p><blockquote><p><strong>Note</strong>: A dynamic task cannot refer to itself or a circular dependency will
result. In the example above, there would be a circular dependency if
the code passed to taskDyn referenced myTask.
</p></blockquote><h3 id="Using+Def.sequential">Using Def.sequential<a href="#Using+Def.sequential" class="header-link"><span class="header-link-content">&nbsp;</span></a></h3><p>sbt 0.13.8 added <code>Def.sequential</code> function to run tasks under semi-sequential semantics.
This is similar to the dynamic task, but easier to define.
To demonstrate the sequential task, let’s create a custom task called <code>compilecheck</code> that runs <code>Compile / compile</code> and then <code>Compile / scalastyle</code> task added by <a href="http://www.scalastyle.org/sbt.html">scalastyle-sbt-plugin</a>.
</p><pre><code class="prettyprint lang-scala">lazy val compilecheck = taskKey[Unit](&quot;compile and then scalastyle&quot;)

lazy val root = (project in file(&quot;.&quot;))
  .settings(
    Compile / compilecheck := Def.sequential(
      Compile / compile,
      (Compile / scalastyle).toTask(&quot;&quot;)
    ).value
  )
</code></pre><p>To call this task type in <code>compilecheck</code> from the shell. If the compilation fails, <code>compilecheck</code> would stop the execution.
</p><pre><code class="">root&gt; compilecheck
[info] Compiling 1 Scala source to /Users/x/proj/target/scala-2.10/classes...
[error] /Users/x/proj/src/main/scala/Foo.scala:3: Unmatched closing brace '}' ignored here
[error] }
[error] ^
[error] one error found
[error] (compile:compileIncremental) Compilation failed
</code></pre><h3 id="Handling+Failure">Handling Failure<a href="#Handling+Failure" class="header-link"><span class="header-link-content">&nbsp;</span></a></h3><p>This section discusses the <code>failure</code>, <code>result</code>, and <code>andFinally</code>
methods, which are used to handle failure of other tasks.
</p><h4 id=""><code>failure</code><a href="#" class="header-link"><span class="header-link-content">&nbsp;</span></a></h4><p>The <code>failure</code> method creates a new task that returns the <code>Incomplete</code>
value when the original task fails to complete normally. If the original
task succeeds, the new task fails.
<a href="../api/sbt/Incomplete.html">Incomplete</a> is an exception with
information about any tasks that caused the failure and any underlying
exceptions thrown during task execution.
</p><p>For example:
</p><pre><code class="prettyprint lang-scala">intTask := sys.error(&quot;Failed.&quot;)

intTask := {
   println(&quot;Ignoring failure: &quot; + intTask.failure.value)
   3
}
</code></pre><p>This overrides the <code>intTask</code> so that the original exception is printed
and the constant <code>3</code> is returned.
</p><p><code>failure</code> does not prevent other tasks that depend on the target from
failing. Consider the following example:
</p><pre><code class="prettyprint lang-scala">intTask := if(shouldSucceed) 5 else sys.error(&quot;Failed.&quot;)

// Return 3 if intTask fails. If intTask succeeds, this task will fail.
aTask := intTask.failure.value - 2

// A new task that increments the result of intTask.
bTask := intTask.value + 1

cTask := aTask.value + bTask.value
</code></pre><p>The following table lists the results of each task depending on the
initially invoked task:
</p><table class="table table-striped">
  <thead>
    <tr>
      <th>invoked task</th>
      <th>intTask result</th>
      <th>aTask result</th>
      <th>bTask result</th>
      <th>cTask result</th>
      <th>overall result</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>intTask</td>
      <td>failure</td>
      <td>not run</td>
      <td>not run</td>
      <td>not run</td>
      <td>failure</td>
    </tr>
    <tr>
      <td>aTask</td>
      <td>failure</td>
      <td>success</td>
      <td>not run</td>
      <td>not run</td>
      <td>success</td>
    </tr>
    <tr>
      <td>bTask</td>
      <td>failure</td>
      <td>not run</td>
      <td>failure</td>
      <td>not run</td>
      <td>failure</td>
    </tr>
    <tr>
      <td>cTask</td>
      <td>failure</td>
      <td>success</td>
      <td>failure</td>
      <td>failure</td>
      <td>failure</td>
    </tr>
    <tr>
      <td>intTask</td>
      <td>success</td>
      <td>not run</td>
      <td>not run</td>
      <td>not run</td>
      <td>success</td>
    </tr>
    <tr>
      <td>aTask</td>
      <td>success</td>
      <td>failure</td>
      <td>not run</td>
      <td>not run</td>
      <td>failure</td>
    </tr>
    <tr>
      <td>bTask</td>
      <td>success</td>
      <td>not run</td>
      <td>success</td>
      <td>not run</td>
      <td>success</td>
    </tr>
    <tr>
      <td>cTask</td>
      <td>success</td>
      <td>failure</td>
      <td>success</td>
      <td>failure</td>
      <td>failure</td>
    </tr>
  </tbody>
</table><p>The overall result is always the same as the root task (the directly
invoked task). A <code>failure</code> turns a success into a failure, and a failure
into an <code>Incomplete</code>. A normal task definition fails when any of its
inputs fail and computes its value otherwise.
</p><h4 id=""><code>result</code><a href="#" class="header-link"><span class="header-link-content">&nbsp;</span></a></h4><p>The <code>result</code> method creates a new task that returns the full <code>Result[T]</code>
value for the original task. <a href="../api/sbt/Result.html">Result</a> has
the same structure as <code>Either[Incomplete, T]</code> for a task result of type
<code>T</code>. That is, it has two subtypes:
</p><ul><li><code>Inc</code>, which wraps <code>Incomplete</code> in case of failure
</li><li><code>Value</code>, which wraps a task’s result in case of success.
</li></ul><p>Thus, the task created by <code>result</code> executes whether or not the original
task succeeds or fails.
</p><p>For example:
</p><pre><code class="prettyprint lang-scala">intTask := sys.error(&quot;Failed.&quot;)

intTask := {
   intTask.result.value match {
      case Inc(inc: Incomplete) =&gt;
         println(&quot;Ignoring failure: &quot; + inc)
         3
      case Value(v) =&gt;
         println(&quot;Using successful result: &quot; + v)
         v
   }
}
</code></pre><p>This overrides the original <code>intTask</code> definition so that if the original
task fails, the exception is printed and the constant <code>3</code> is returned.
If it succeeds, the value is printed and returned.
</p><h5 id="andFinally">andFinally<a href="#andFinally" class="header-link"><span class="header-link-content">&nbsp;</span></a></h5><p>The <code>andFinally</code> method defines a new task that runs the original task
and evaluates a side effect regardless of whether the original task
succeeded. The result of the task is the result of the original task.
For example:
</p><pre><code class="prettyprint lang-scala">intTask := sys.error(&quot;I didn't succeed.&quot;)

lazy val intTaskImpl = intTask andFinally { println(&quot;andFinally&quot;) }

intTask := intTaskImpl.value
</code></pre><p>This modifies the original <code>intTask</code> to always print “andFinally” even
if the task fails.
</p><p>Note that <code>andFinally</code> constructs a new task. This means that the new
task has to be invoked in order for the extra block to run. This is
important when calling andFinally on another task instead of overriding
a task like in the previous example. For example, consider this code:
</p><pre><code class="prettyprint lang-scala">intTask := sys.error(&quot;I didn't succeed.&quot;)

lazy val intTaskImpl = intTask andFinally { println(&quot;andFinally&quot;) }

otherIntTask := intTaskImpl.value
</code></pre><p>If <code>intTask</code> is run directly, <code>otherIntTask</code> is never involved in
execution. This case is similar to the following plain Scala code:
</p><pre><code class="prettyprint lang-scala">def intTask(): Int =
  sys.error(&quot;I didn't succeed.&quot;)

def otherIntTask(): Int =
  try { intTask() }
  finally { println(&quot;finally&quot;) }

intTask()
</code></pre><p>It is obvious here that calling intTask() will never result in “finally”
being printed.
</p><div class="bottom nav">
                <div class="row">
                  <div class="col-md-auto">
                    <a href="Caching.html">
                      <div class="arrowitem">
                        <span class="arrow">&gt;</span>
                      </div>

                      <div class="arrowitem">
                        <em>Next page</em><br/>
                        Caching
                      </div>

                    </a>
                  </div>
                </div>
                <div class="row w-100">
        <div class="col-md-auto ml-auto">
          <ul class="language-bar">
            
          </ul>
        </div>
      </div>
              </div>
                  </div>
                </div>
          </div> <!-- row -->
        </div>
        <div class="header">
          <link href="https://fonts.googleapis.com/css?family=Roboto:100normal,100italic,300normal,300italic,400normal,400italic,500normal,500italic,700normal,700italic,900normal,900italicc" rel="stylesheet" type="text/css"/>
<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600,700,900,400italic,700italic" rel="stylesheet" type="text/css">
<!-- Algolia stylesheet -->
<link href="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.css" rel="stylesheet" type = "text/css">
<div class="container-fluid top nav">
  <div class="row w-100">
    <div class="col-md-4">
      <div class="logo">
        <a href="../../"><img src="files/sbt-logo.svg" alt="sbt"></a>
        <span class="versions"><select id="versions"></select></span>
      </div>
    </div>
    <div class="col-md-8">
        <div class="docsearch">
          <input type="text" id="doc-search-bar" placeholder="Search...">
          <ul class="result-container" id="result-container" style="display: none;"></ul>
        </div>
        <div class="nav" id="topbar">
          <a href="../../learn.html">Learn</a>
          <a href="../../download.html">Download</a>
          <a href="../../community.html">Get Involved</a>
          <a id="source-code" href="https://github.com/sbt/sbt"><img src="files/github-logo-teal.svg" alt="Source code" class="social"></a>
          <a id="twitter" href="https://twitter.com/scala_sbt"><img src="files/twitter-logo-teal.svg" alt="sbt on Twitter" class="social"></a>
          <a id="edit-on-github" href="https://github.com/sbt/website/edit/develop/src/reference/02-DetailTopics/04-Tasks-and-Commands/01-Tasks.md"><img src="files/octicon-pencil.svg" alt="Edit on GitHub"></a>
        </div>
    </div>
  </div>
</div>
<script defer data-domain="scala-sbt.org" src="https://plausible.scala-lang.org/js/script.js"></script>
<script type="text/javascript">
$(function() {
var scrollDown = function() {
if (window.location.hash !== "") {
  setTimeout(function() { $(window).scrollTop($(window).scrollTop() - 120); }, 100);
}
}
scrollDown();
$(window).bind('hashchange', function() {
scrollDown();
});
});
</script>

        </div>
        <div class="footer">
          <footer>
  <div class="container-fluid footer">
    <div class="row">
      <div class="col-md-8">
        <div class="support-item">
          <div class="support-icon">
            <svg class="svg-icon svg-icon-chat" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 97.5 85.2" enable-background="new 0 0 97.5 85.2"><path stroke="#fff" stroke-width="4.282" stroke-linecap="round" stroke-miterlimit="10" d="M27 29.5h-16.3c-4.7 0-8.6 3.9-8.6 8.6v25.7c0 4.7 3.9 8.6 8.6 8.6h2.7c.8 0 1.5.7 1.5 1.5v7.8c0 1.3 1.6 2 2.5 1l9.5-9.5c.5-.5 1.2-.8 2-.8h20.2c4.7 0 8.6-3.9 8.6-8.6v-7.8" fill="none"/><path fill="#fff" d="M85 0h-40c-6.9 0-12.5 5.6-12.5 12.5v33.4c0 2.2 1.8 4.1 4.1 4.1h29.9c.7 0 1.3.3 1.8.7l10 10c1.6 1.6 4.3.5 4.3-1.8v-6.5c0-1.4 1.1-2.5 2.5-2.5 6.9 0 12.5-5.6 12.5-12.5v-25c-.1-6.8-5.8-12.4-12.6-12.4z"/></svg>
          </div>
          <div class="support-detail">
            <h2>Community Support</h2>
            <a href="https://stackoverflow.com/questions/tagged/sbt">StackOverflow</a>
          </div>
        </div>
      </div>
      <div class="col-md-4 text-right ts">
        &copy; 2023-<script>document.write(new Date().getFullYear())</script> Scala Center
      </div>
    </div>
  </div>
</footer><script src="/assets/versions.js"></script><script src="/assets/set-versions.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script><script type="text/javascript"> docsearch({
  apiKey: 'e47ee877a07ea1c48722f08430d54913',
  indexName: 'scala-sbt',
  inputSelector: '#doc-search-bar',
  debug: false // Set debug to true if you want to inspect the dropdown
});
</script>
        </div>
        
        <div class="highlight-outer">
              <div class="highlight-menu">
                <ul>
                  <li><button id="highlight-button-twitter"><img src="img/twitter-bird-dark-bgs.png"/></button></li>
                </ul>
              </div>
            </div>
      </body>
    </html>